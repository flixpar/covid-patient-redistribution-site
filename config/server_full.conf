worker_processes auto;

events {}

http {
	include /etc/nginx/mime.types;
	charset utf-8;

	log_format custom_log_fmt	'$remote_addr - $remote_user [$time_local] '
								'"$request" $status $body_bytes_sent '
								'"$http_referer" "$http_user_agent" '
								'- $upstream_connect_time $upstream_header_time '
								'$upstream_response_time $request_time';
	error_log  /home/flixpar/jhhs-patient-redistribution-site/logs/error.log  info;
	access_log /home/flixpar/jhhs-patient-redistribution-site/logs/access.log custom_log_fmt;

	gzip on;
	gzip_types *;
	gzip_min_length 1024;
	gzip_proxied any;

	sendfile on;
	tcp_nopush on;

	proxy_http_version 1.1;
	proxy_ignore_client_abort on;
	proxy_read_timeout 240;

	proxy_cache_path /home/flixpar/cache/ keys_zone=maincache:2m inactive=30d max_size=50m;
	proxy_cache_methods POST;
	proxy_cache_key $request_uri|$request_body;	
	proxy_ignore_headers Cache-Control;
	proxy_cache_valid any 1y;
	proxy_cache_min_uses 1;

	server {
		listen 80 http2;
		server_name jhhs-patient-redistribution.com;

		root /home/flixpar/jhhs-patient-redistribution-site/public/;

		location / {
		}

		location = / {
			index html/home.html;
		}

		location = /patients {
			default_type "text/html";
			alias /home/flixpar/jhhs-patient-redistribution-site/public/html/patients.html;
		}

		location = /about {
			default_type "text/html";
			alias /home/flixpar/jhhs-patient-redistribution-site/public/html/about.html;
		}

		location /api {
			proxy_pass http://0.0.0.0:8000;

			proxy_cache maincache;
			add_header X-Cache-Status $upstream_cache_status;
		}

		error_page 404 /error-404.html;
		error_page 500 /error-500.html;

	}
}
